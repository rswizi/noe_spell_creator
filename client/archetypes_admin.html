<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Archetypes Admin</title>
  <link rel="stylesheet" href="/static/style.css" />
  <style>
    :root { color-scheme: dark; }
    body{
      margin:0;
      background:radial-gradient(circle at 20% 20%, #18151d 0%, #0b0b0f 45%, #050508 100%);
      color:#f3f3f5;
      font-family: "Segoe UI", system-ui, sans-serif;
      min-height:100vh;
    }
    .page{max-width:1080px;margin:0 auto;padding:24px 16px 60px;}
    h1{margin:0 0 10px;font-size:24px;}
    .muted{opacity:.8;font-size:.95rem;}
    .card{
      border:1px solid #2a2a3a;
      border-radius:14px;
      padding:14px;
      background:linear-gradient(145deg,#12121a,#0e0e14);
      box-shadow:0 18px 40px rgba(0,0,0,0.45);
      margin-bottom:14px;
    }
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;}
    .stack{display:flex;flex-direction:column;gap:8px;}
    label{font-size:.92rem;}
    input,select,textarea{
      padding:9px 11px;
      border:1px solid #2a2a3a;
      border-radius:10px;
      background:#181821;
      color:#f3f3f5;
      min-width:0;
    }
    textarea{min-height:70px;resize:vertical;}
    button{
      padding:9px 12px;
      border:1px solid #c53535;
      border-radius:10px;
      background:#c53535;
      color:#fff;
      cursor:pointer;
      transition:.15s ease;
    }
    button.subtle{background:#1c1c24;border-color:#3a3a46;color:#e5e5e8;}
    button:hover{filter:brightness(1.08);}
    table{width:100%;border-collapse:collapse;}
    th,td{border-bottom:1px solid #222;padding:8px;text-align:left;}
    .pill{padding:4px 8px;border-radius:999px;border:1px solid #333;background:#14141b;}
    .section-title{margin:0 0 6px;font-size:16px;}
    .two-col{display:grid;grid-template-columns:1fr;gap:12px;}
    @media(min-width:900px){ .two-col{grid-template-columns:2fr 1fr;} }
    .rule-row,.rank-row{display:flex;flex-wrap:wrap;gap:8px;align-items:center;}
    .rule-row select,.rule-row input{min-width:120px;}
    .rank-row select{min-width:200px; flex:1;}
    .pending-item{border:1px solid #2a2a3a;border-radius:12px;padding:10px;margin-top:8px;background:#12121a;}
    .pending-item.pending{border-color:#5a4f00;box-shadow:0 0 0 1px #5a4f00 inset;}
    .pending-item.rejected{border-color:#6b1b1b;box-shadow:0 0 0 1px #6b1b1b inset;}
    .status-pill.pending{color:#ffd34d;border-color:#5a4f00;background:#2b2500;}
    .status-pill.rejected{color:#ff9090;border-color:#6b1b1b;background:#2a1010;}
    .status-pill.approved{color:#7dffb0;border-color:#1d4d2d;background:#0f2a18;}
    .rich-editor { border:1px solid #333; border-radius:12px; background:#0f0f0f; }
    .rich-toolbar { display:flex; flex-wrap:wrap; gap:6px; padding:6px 8px; border-bottom:1px solid #1f1f1f; }
    .rich-toolbar button { padding:6px 8px; font-size:.9rem; border-radius:8px; border:1px solid #2d2d2d; background:#161616; color:#f3f3f3; cursor:pointer; }
    .rich-toolbar button:hover { background:#1f1f1f; }
    .rich-toolbar button:active { background:#222; }
    .rich-area { min-height:130px; padding:10px; outline:none; }
    .rich-area:empty:before { content: attr(data-placeholder); color:#777; }
    .rich-area table { width:100%; border-collapse:collapse; margin-top:6px; }
    .rich-area th, .rich-area td { border:1px solid #333; padding:6px; }
  </style>
</head>
<body>
  <div class="page">
    <h1>Archetypes (Moderator)</h1>
    <div class="muted" style="margin-bottom:14px;">Build archetypes, wire abilities and versions, and enforce prerequisites (highest/2nd/3rd stat or minimum values). Hybrid sources pull from existing archetypes.</div>

    <div class="row" style="margin-bottom:12px; justify-content:space-between;">
      <div class="row" style="gap:10px; align-items:center;">
        <h1 style="margin:0;">Archetypes (Moderator)</h1>
      </div>
      <a class="subtle" href="abilities_home.html" style="text-decoration:none; padding:8px 12px; border-radius:10px; border:1px solid #3a3a46; background:#1c1c24; color:#e5e5e8;">Back</a>
    </div>
    <div class="two-col">
      <div class="card stack">
        <div class="row">
          <input id="arc-name" placeholder="Name" style="flex:1;">
          <label class="row" style="gap:6px;"><input type="checkbox" id="arc-hybrid"> Hybrid</label>
          <button id="arc-save">Save / Update</button>
          <input type="hidden" id="arc-editing" value="">
        </div>
        <div class="row">
          <textarea id="arc-prereq-text" placeholder="Prerequisite description" style="flex:1;"></textarea>
        </div>
        <div>
          <label style="display:block; margin:2px 0 6px;">Archetype Description</label>
          <div id="arc-desc-editor" class="rich-editor">
            <div class="rich-toolbar">
              <button type="button" data-cmd="bold" title="Bold">Bold</button>
              <button type="button" data-cmd="italic" title="Italic">Italic</button>
              <button type="button" data-cmd="underline" title="Underline">Underline</button>
              <button type="button" data-cmd="table" title="Insert 2x2 table">Table</button>
              <button type="button" data-cmd="removeFormat" title="Clear formatting">Clear</button>
            </div>
            <div class="rich-area" contenteditable="true" data-placeholder="Describe the archetype and its theme."></div>
          </div>
        </div>
        <div id="sources-block" class="card" style="margin:0;">
          <div class="section-title">Source archetypes (for hybrids)</div>
          <div id="arc-sources" class="row" style="align-items:flex-start;"></div>
        </div>

        <div class="card" style="margin:0;">
          <div class="row" style="justify-content:space-between;align-items:center;">
            <div class="section-title">Prerequisite rules</div>
            <button class="subtle" id="pr-add">+ Add rule</button>
          </div>
          <div id="pr-list" class="stack"></div>
        </div>

        <div class="card" style="margin:0;">
          <div class="row" style="justify-content:space-between;align-items:center;">
            <div class="section-title">Ranks (12 fixed)</div>
          </div>
          <div class="row" style="margin:6px 0 10px;">
            <label for="arc-ability-tag-filter">Filter abilities by tag</label>
            <input id="arc-ability-tag-filter" placeholder="Comma-separated tags" style="flex:1;">
            <label for="arc-ability-source-filter">Source</label>
            <input id="arc-ability-source-filter" placeholder="Source category or ref" style="flex:1;">
          </div>
          <div id="rank-list" class="stack"></div>
        </div>
        <div id="arc-status" class="muted"></div>
      </div>

      <div class="card">
        <div class="row" style="justify-content:space-between;align-items:center;">
          <div>
            <div class="section-title">Existing archetypes</div>
            <div class="muted" style="margin-top:2px;">Select to edit or delete.</div>
          </div>
          <button class="subtle" id="arc-refresh">Refresh</button>
        </div>
        <div id="arc-list" style="margin-top:10px;"></div>
      </div>

      <div class="card" id="pending-panel" style="display:none;">
        <div class="row" style="justify-content:space-between;align-items:center;">
          <div class="section-title">Pending submissions</div>
          <button class="subtle" id="pending-refresh">Refresh</button>
        </div>
        <div id="pending-list" style="margin-top:10px;"></div>
      </div>
    </div>
  </div>

<script>
const token = localStorage.getItem('auth_token') || "";
const authHeaders = () => token ? { "Authorization": "Bearer " + token } : {};
const $ = s=>document.querySelector(s);
let ABILITIES = [];
let ARCHETYPES = [];
const abilityTagFilterEl = document.getElementById('arc-ability-tag-filter');
const abilitySourceFilterEl = document.getElementById('arc-ability-source-filter');
const pendingPanel = document.getElementById('pending-panel');
const pendingListEl = document.getElementById('pending-list');
const pendingRefreshBtn = document.getElementById('pending-refresh');
let ROLE = '';

function setupRichTextEditor(containerId, placeholder=''){
  const container = document.getElementById(containerId);
  if (!container) throw new Error('Missing rich text container '+containerId);
  const area = container.querySelector('.rich-area');
  if (!area) throw new Error('Missing rich text area in '+containerId);
  if (placeholder) area.setAttribute('data-placeholder', placeholder);

  const sanitizePastedHtml = (html, text) => {
    if (html){
      const doc = new DOMParser().parseFromString(html, 'text/html');
      doc.querySelectorAll('*').forEach(el=>{
        el.removeAttribute('color');
        el.style.color = '';
        if (el.getAttribute('style') === '') el.removeAttribute('style');
      });
      return doc.body.innerHTML;
    }
    if (text != null){
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML.replace(/\n/g, '<br>');
    }
    return '';
  };
  area.addEventListener('paste', (e)=>{
    const html = e.clipboardData?.getData('text/html');
    const text = e.clipboardData?.getData('text/plain');
    if (html || text){
      e.preventDefault();
      const cleaned = sanitizePastedHtml(html, text);
      if (cleaned) document.execCommand('insertHTML', false, cleaned);
    }
  });

  const normalizeHtml = (html)=>{
    const text = (area.textContent || '').replace(/\u00a0/g, ' ').trim();
    const raw = (html || '').trim();
    if (!text) return '';
    return raw;
  };

  container.querySelectorAll('[data-cmd]').forEach(btn=>{
    btn.addEventListener('click', (ev)=>{
      ev.preventDefault();
      area.focus();
      const cmd = btn.dataset.cmd;
      if (cmd === 'table'){
        const tbl = '<table class="rte-table"><tbody><tr><td>Cell 1</td><td>Cell 2</td></tr><tr><td>Cell 3</td><td>Cell 4</td></tr></tbody></table>';
        document.execCommand('insertHTML', false, tbl);
      }else{
        document.execCommand(cmd, false, null);
      }
    });
  });

  return {
    el: area,
    getHTML: ()=> normalizeHtml(area.innerHTML),
    setHTML: (html='')=>{ area.innerHTML = html || ''; },
  };
}

const arcDescEditor = setupRichTextEditor('arc-desc-editor', 'Describe the archetype and its theme.');

function parseTagFilter(val){
  return String(val || '').split(',').map(t=>t.trim().toLowerCase()).filter(Boolean);
}
function abilityMatchesTags(a, tags){
  if (!tags.length) return true;
  const abTags = (a?.tags || []).map(t=> String(t || '').toLowerCase()).filter(Boolean);
  return tags.some(t=> abTags.includes(t));
}
function parseSourceFilter(val){
  return String(val || '').trim().toLowerCase();
}
function abilityMatchesSource(a, src){
  if (!src) return true;
  const cat = String(a?.source_category || '').toLowerCase();
  const ref = String(a?.source_ref || '').toLowerCase();
  return cat.includes(src) || ref.includes(src);
}
function filteredAbilities(){
  const tags = parseTagFilter(abilityTagFilterEl?.value);
  const src = parseSourceFilter(abilitySourceFilterEl?.value);
  if (!tags.length && !src) return ABILITIES.slice();
  return ABILITIES.filter(a=> abilityMatchesTags(a, tags) && abilityMatchesSource(a, src));
}

function optionLabelAbility(a){
  return `${a.name || 'Ability'} (${a.id})`;
}

function populateAbilitySelect(sel, selectedId=""){
  const base = filteredAbilities();
  const selected = selectedId ? ABILITIES.find(a=> a.id === selectedId) : null;
  const list = selected && !base.some(a=> a.id === selectedId) ? [selected, ...base] : base;
  sel.innerHTML = `<option value="">-- choose ability --</option>` + list.map(a=>`<option value="${a.id}" ${a.id===selectedId?'selected':''}>${optionLabelAbility(a)}</option>`).join("");
}

function populateReplaceSelect(sel, selectedId=""){
  sel.innerHTML = `<option value="">-- none --</option>` + ABILITIES.map(a=>`<option value="${a.id}" ${a.id===selectedId?'selected':''}>${optionLabelAbility(a)}</option>`).join("");
}

function renderSources(){
  const box = $("#arc-sources");
  box.innerHTML = "";
  ARCHETYPES.forEach(a=>{
    const id = `src-${a.id}`;
    const lbl = document.createElement('label');
    lbl.className = "row";
    lbl.style.gap = "6px";
    lbl.innerHTML = `<input type="checkbox" value="${a.id}" id="${id}"> <span>${a.name}</span>`;
    box.appendChild(lbl);
  });
}

function setSelectedSources(ids=[]){
  const set = new Set(ids||[]);
  document.querySelectorAll('#arc-sources input[type="checkbox"]').forEach(cb=>{
    cb.checked = set.has(cb.value);
  });
}

function getSelectedSources(){
  const out = [];
  document.querySelectorAll('#arc-sources input[type="checkbox"]:checked').forEach(cb=> out.push(cb.value));
  return out;
}

async function checkMe(){
  try{
    const res = await fetch("/auth/me", { headers: authHeaders() });
    const j = await res.json().catch(()=>({}));
    if (j.status === "success"){
      ROLE = (j.role || "").toLowerCase();
      if (ROLE === "moderator" || ROLE === "admin"){
        if (pendingPanel) pendingPanel.style.display = "";
        loadPendingSubmissions().catch(()=>{});
      }
    }
  }catch{}
}

async function loadPendingSubmissions(){
  if (!pendingListEl) return;
  const r = await fetch("/submissions?type=archetype", { headers: authHeaders() });
  const j = await r.json().catch(()=>({}));
  if (j.status !== "success"){
    pendingListEl.innerHTML = `<div class="muted">${j.message || "Load failed"}</div>`;
    return;
  }
  const subs = j.submissions || [];
  if (!subs.length){
    pendingListEl.innerHTML = '<div class="muted">No submissions.</div>';
    return;
  }
  pendingListEl.innerHTML = "";
  subs.forEach(s=>{
    const status = (s.status || "pending").toLowerCase();
    const name = s.payload?.name || s.id || "Submission";
    const div = document.createElement("div");
    div.className = `pending-item ${status}`;
    div.innerHTML = `
      <div class="row" style="justify-content:space-between;align-items:center;">
        <strong>${name}</strong>
        <span class="pill status-pill ${status}">${status}</span>
      </div>
      <div class="muted">${s.submitter || "unknown"} â€¢ ${s.created_at || ""}</div>
      ${s.review_note ? `<div class="muted">Note: ${s.review_note}</div>` : ""}
      <div class="row" style="margin-top:6px;">
        <button class="subtle" data-action="load">Load</button>
        <button class="subtle" data-action="approve">Approve</button>
        <button class="subtle" data-action="reject">Reject</button>
      </div>
    `;
    div.querySelector('[data-action="load"]').addEventListener("click", ()=>{
      const payload = s.payload || {};
      loadToForm({ ...payload, id: "" });
      $("#arc-editing").value = "";
      $("#arc-status").textContent = "Loaded pending submission.";
    });
    const approveBtn = div.querySelector('[data-action="approve"]');
    const rejectBtn = div.querySelector('[data-action="reject"]');
    if (status !== "pending"){
      approveBtn.disabled = true;
      rejectBtn.disabled = true;
    }
    approveBtn.addEventListener("click", async ()=>{
      await fetch(`/submissions/${encodeURIComponent(s.id)}/approve`, { method:"POST", headers:{ "Content-Type":"application/json", ...authHeaders() }, body:"{}" });
      await loadPendingSubmissions();
      await loadList();
    });
    rejectBtn.addEventListener("click", async ()=>{
      const note = prompt("Reason for rejection (optional):") || "";
      await fetch(`/submissions/${encodeURIComponent(s.id)}/reject`, { method:"POST", headers:{ "Content-Type":"application/json", ...authHeaders() }, body: JSON.stringify({ note }) });
      await loadPendingSubmissions();
    });
    pendingListEl.appendChild(div);
  });
}

function ruleRow(rule={}){
  const div = document.createElement('div');
  div.className = 'rule-row';
  const val = rule.value ?? '';
  const type = rule.type || 'highest';
  const key = rule.key || '';
  div.innerHTML = `
    <select class="pr-attr">
      <option value="">Characteristic</option>
      <option value="reflex">Reflex</option><option value="dexterity">Dexterity</option><option value="body">Body</option>
      <option value="wisdom">Wisdom</option><option value="presence">Presence</option><option value="magic">Magic</option>
      <option value="willpower">Willpower</option><option value="tech">Tech</option>
    </select>
    <select class="pr-type">
      <option value="highest">Highest</option>
      <option value="second">Second highest</option>
      <option value="third">Third highest</option>
      <option value="highest_any">Any of the following are the Highest</option>
      <option value="second_any">Any of the following are the Second Highest</option>
      <option value="min">Not lower than</option>
    </select>
    <input class="pr-val" type="number" placeholder="Value" style="width:100px; display:${type==='min'?'block':'none'};" value="${type==='min'?val:''}">
    <input class="pr-any" type="text" placeholder="Any of: REF, BOD, DEX" style="min-width:220px; display:${(type==='highest_any'||type==='second_any')?'block':'none'};" value="${(rule.keys||[]).join(', ')}">
    <button class="subtle pr-del">Remove</button>
  `;
  div.querySelector('.pr-attr').value = key;
  div.querySelector('.pr-type').value = type;
  div.querySelector('.pr-type').addEventListener('change', (e)=>{
    const isMin = e.target.value === 'min';
    const isAny = e.target.value === 'highest_any' || e.target.value === 'second_any';
    div.querySelector('.pr-val').style.display = isMin ? 'block' : 'none';
    div.querySelector('.pr-any').style.display = isAny ? 'block' : 'none';
    div.querySelector('.pr-attr').disabled = isAny;
  });
  if (type === 'highest_any' || type === 'second_any') div.querySelector('.pr-attr').disabled = true;
  div.querySelector('.pr-del').addEventListener('click', ()=>div.remove());
  return div;
}

function rankRow(idx, r={}){
  const div = document.createElement('div');
  div.className = 'rank-row';
  div.innerHTML = `
    <div class="pill">Rank ${idx+1}</div>
    <select class="rk-abil" style="flex:1; min-width:220px;"></select>
  `;
  populateAbilitySelect(div.querySelector('.rk-abil'), r.ability_id || "");
  return div;
}

function collectDoc(){
  const ranks=[];
  document.querySelectorAll('#rank-list .rank-row').forEach((row, idx)=>{
    ranks.push({
      rank: idx + 1,
      ability_id: row.querySelector('.rk-abil').value.trim(),
    });
  });
  const charOrder = [];
  const charOrderAny = [];
  const charMin = {};
  document.querySelectorAll('#pr-list .rule-row').forEach(row=>{
    const attr = row.querySelector('.pr-attr').value;
    const typ = row.querySelector('.pr-type').value;
    const val = row.querySelector('.pr-val').value;
    if(typ === 'highest_any' || typ === 'second_any'){
      const raw = (row.querySelector('.pr-any').value || '');
      const keys = raw.split(',').map(s=>s.trim()).filter(Boolean);
      const pos = typ === 'second_any' ? 2 : 1;
      if (keys.length) charOrderAny.push({ position: pos, keys });
      return;
    }
    if(!attr) return;
    if(typ === 'min'){
      if(val !== "") charMin[attr] = Number(val);
    }else{
      const pos = typ === 'highest' ? 1 : typ === 'second' ? 2 : 3;
      charOrder.push({key: attr, position: pos});
    }
  });
  return {
    name: $("#arc-name").value.trim(),
    hybrid: $("#arc-hybrid").checked,
    sources: getSelectedSources(),
    prereq_text: $("#arc-prereq-text").value.trim(),
    description_html: arcDescEditor.getHTML(),
    prereq_rules:{
      char_order: charOrder,
      char_min: charMin,
      char_order_any: charOrderAny
    },
    ranks
  };
}

async function saveArchetype(){
  const body = collectDoc();
  const editing = $("#arc-editing").value;
  const path = editing ? `/archetypes/${encodeURIComponent(editing)}` : "/archetypes";
  const method = editing ? "PUT" : "POST";
  $("#arc-status").textContent = "Saving...";
  const r = await fetch(path, { method, headers:{ "Content-Type":"application/json", ...authHeaders() }, body: JSON.stringify(body)});
  const j = await r.json().catch(()=>({}));
  if (j.status === "pending"){ $("#arc-status").textContent = "Submitted for review."; return; }
  if (j.status !== "success"){ $("#arc-status").textContent = j.message || "Save failed"; return; }
  $("#arc-status").textContent = "Saved.";
  $("#arc-editing").value = editing || j.archetype?.id || "";
  loadList();
}

function loadToForm(a){
  $("#arc-editing").value = a.id;
  $("#arc-name").value = a.name || "";
  $("#arc-hybrid").checked = !!a.hybrid;
  setSelectedSources(a.sources || []);
  $("#arc-prereq-text").value = a.prereq_text || "";
  arcDescEditor.setHTML(a.description_html || a.description || "");
  const rl = $("#rank-list"); rl.innerHTML = "";
  const ranks = a.ranks || [];
  for (let i=0; i<12; i++){
    rl.appendChild(rankRow(i, ranks[i] || {}));
  }
  const pl = $("#pr-list"); pl.innerHTML = "";
  const rules = [];
  const order = a.prereq_rules?.char_order || [];
  order.forEach(r=> rules.push({key:r.key, type: r.position===2?'second': r.position===3?'third':'highest'}));
  if (!order.length && a.prereq_rules?.mag_highest){
    rules.push({key:"magic", type:"highest"});
  }
  const anyOrder = a.prereq_rules?.char_order_any || [];
  anyOrder.forEach(r=>{
    const pos = Number(r.position || 1);
    rules.push({ type: pos === 2 ? 'second_any' : 'highest_any', keys: r.keys || [] });
  });
  const charMin = a.prereq_rules?.char_min || {};
  Object.keys(charMin).forEach(k=> rules.push({key:k, type:'min', value: charMin[k]}));
  if (!rules.length) rules.push({});
  rules.forEach(r=> pl.appendChild(ruleRow(r)));
}

async function loadList(){
  const box = $("#arc-list"); box.innerHTML = "Loading...";
  const r = await fetch("/archetypes", { headers: authHeaders() });
  const j = await r.json().catch(()=>({}));
  if (j.status !== "success"){ box.textContent = j.message || "Load failed"; return; }
  ARCHETYPES = j.archetypes || [];
  renderSources();
  box.innerHTML = "";
  ARCHETYPES.forEach(a=>{
    const div = document.createElement('div'); div.className='card';
    div.style.marginBottom = "10px";
    div.innerHTML = `
      <div class="row" style="justify-content:space-between;">
        <div><b>${a.name}</b> ${a.hybrid?'<span class="pill">Hybrid</span>':''}</div>
        <div class="row">
          <button class="subtle edit">Edit</button>
          <button class="subtle del">Delete</button>
        </div>
      </div>
      <div class="muted">${a.prereq_text || ''}</div>
      <div class="muted" style="margin-top:4px;">Ranks: ${(a.ranks||[]).length}</div>
    `;
    div.querySelector('.edit').addEventListener('click', ()=> loadToForm(a));
    div.querySelector('.del').addEventListener('click', async ()=>{
      if (!confirm(`Delete archetype ${a.name}?`)) return;
      const r2 = await fetch(`/archetypes/${encodeURIComponent(a.id)}`, { method:"DELETE", headers: authHeaders() });
      const j2 = await r2.json().catch(()=>({}));
      if (j2.status !== "success"){ alert(j2.message || "Delete failed"); return; }
      loadList();
    });
    box.appendChild(div);
  });
}

async function loadAbilities(){
  const resp = await fetch("/abilities", { headers: authHeaders() });
  const j = await resp.json().catch(()=>({}));
  if (j.status !== "success") { console.error("Failed to load abilities", j); return; }
  ABILITIES = j.abilities || [];
  // refresh selects
  document.querySelectorAll('.rk-abil').forEach(sel=> populateAbilitySelect(sel, sel.value));
}

abilityTagFilterEl?.addEventListener('input', ()=>{
  document.querySelectorAll('.rk-abil').forEach(sel=> populateAbilitySelect(sel, sel.value));
});
abilitySourceFilterEl?.addEventListener('input', ()=>{
  document.querySelectorAll('.rk-abil').forEach(sel=> populateAbilitySelect(sel, sel.value));
});

document.getElementById("arc-save").addEventListener("click", saveArchetype);
document.getElementById("arc-refresh").addEventListener("click", loadList);
document.getElementById("pr-add").addEventListener("click", ()=> document.getElementById("pr-list").appendChild(ruleRow({})));
pendingRefreshBtn?.addEventListener("click", loadPendingSubmissions);
(()=>{
  const rl = document.getElementById("rank-list");
  rl.innerHTML = "";
  for (let i=0; i<12; i++){ rl.appendChild(rankRow(i, {})); }
})();
document.getElementById("pr-list").appendChild(ruleRow({}));

loadAbilities().then(loadList);
checkMe();
</script>
</body>
</html>
